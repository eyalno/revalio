
for postgres db
export TF_VAR_db_password="SuperSecret123"

terraform apply -var-file="terraform.tfvars"


Outputs:

api_endpoint = "https://fcj4iyrm96.execute-api.us-east-2.amazonaws.com"
dynamodb_table = "usage_aggregates"
rds_endpoint = "terraform-20251109070909505100000001.cny00iaioxw4.us-east-2.rds.amazonaws.com"

Your full endpoints will be:
POST https://fcj4iyrm96.execute-api.us-east-2.amazonaws.com/usage
GET  https://fcj4iyrm96.execute-api.us-east-2.amazonaws.com/stats/average


curl -X POST \
  -H "Content-Type: application/json" \
  -d '{"username": "eyal", "usage_time": 30}' \
  https://fcj4iyrm96.execute-api.us-east-2.amazonaws.com/usage

curl https://fcj4iyrm96.execute-api.us-east-2.amazonaws.com/stats/average




lambda/
 └─ lambda_function.py

	2.	Install dependencies locally (e.g., boto3 and psycopg2-binary) into lambda/ folder:

pip install -r requirements.txt -t lambda/

	3.	Zip the folder contents:

cd lambda
zip -r ../lambda_package.zip .

	4.	Point Terraform filename to lambda_package.zip.

    mkdir -p layer/python
pip install boto3 psycopg2-binary -t layer/python
cd layer
zip -r ../lambda_layer.zip .